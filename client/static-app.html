<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Gestión de Pedidos - Konecta (Versión Estática)</title>
  <style>
    :root {
      --primary-color: #0059A9;
      --primary-hover: #004080;
      --background-color: #f8f9fa;
      --card-background: white;
      --text-color: #333;
      --border-color: #dee2e6;
      --success-color: #28a745;
      --warning-color: #ffc107;
      --danger-color: #dc3545;
      --info-color: #17a2b8;
    }
    
    body {
      font-family: 'Arial', sans-serif;
      line-height: 1.6;
      margin: 0;
      padding: 0;
      color: var(--text-color);
      background-color: var(--background-color);
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      background-color: white;
      border-bottom: 1px solid var(--border-color);
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    .logo {
      font-size: 24px;
      font-weight: bold;
      color: var(--primary-color);
    }
    
    .logo img {
      height: 40px;
      vertical-align: middle;
      margin-right: 10px;
    }
    
    .nav {
      display: flex;
      gap: 20px;
    }
    
    .nav-link {
      color: var(--text-color);
      text-decoration: none;
      padding: 8px 12px;
      border-radius: 4px;
      transition: background-color 0.3s;
    }
    
    .nav-link:hover {
      background-color: rgba(0,0,0,0.05);
    }
    
    .nav-link.active {
      color: var(--primary-color);
      font-weight: 600;
      border-bottom: 2px solid var(--primary-color);
    }
    
    .card {
      background-color: var(--card-background);
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .card-title {
      font-size: 18px;
      margin-top: 0;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border-color);
    }
    
    .btn {
      display: inline-block;
      padding: 8px 16px;
      background-color: var(--primary-color);
      color: white;
      text-decoration: none;
      border-radius: 4px;
      font-weight: bold;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    
    .btn:hover {
      background-color: var(--primary-hover);
    }
    
    .btn-success {
      background-color: var(--success-color);
    }
    
    .btn-success:hover {
      background-color: #218838;
    }
    
    .btn-warning {
      background-color: var(--warning-color);
      color: #212529;
    }
    
    .btn-warning:hover {
      background-color: #e0a800;
    }
    
    .btn-danger {
      background-color: var(--danger-color);
    }
    
    .btn-danger:hover {
      background-color: #c82333;
    }
    
    .alert {
      padding: 12px 15px;
      border-radius: 4px;
      margin-bottom: 20px;
    }
    
    .alert-warning {
      background-color: #fff3cd;
      border: 1px solid #ffeeba;
      color: #856404;
    }
    
    .alert-info {
      background-color: #d1ecf1;
      border: 1px solid #bee5eb;
      color: #0c5460;
    }
    
    .alert-danger {
      background-color: #f8d7da;
      border: 1px solid #f5c6cb;
      color: #721c24;
    }
    
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }
    
    .table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }
    
    .table th,
    .table td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
    }
    
    .table th {
      background-color: rgba(0,0,0,0.03);
      font-weight: 600;
    }
    
    .status-badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.85em;
      font-weight: 500;
    }
    
    .status-nuevo {
      background-color: #e3f2fd;
      color: #0d47a1;
    }
    
    .status-en-proceso {
      background-color: #fff9c4;
      color: #e65100;
    }
    
    .status-completado {
      background-color: #e8f5e9;
      color: #1b5e20;
    }
    
    .status-verificado {
      background-color: #d1c4e9;
      color: #4527a0;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .search-box {
      display: flex;
      margin-bottom: 20px;
    }
    
    .search-input {
      flex: 1;
      padding: 10px;
      border: 1px solid var(--border-color);
      border-radius: 4px 0 0 4px;
      outline: none;
    }
    
    .search-button {
      padding: 10px 20px;
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: 0 4px 4px 0;
      cursor: pointer;
    }
    
    .footer {
      margin-top: 40px;
      padding-top: 20px;
      border-top: 1px solid var(--border-color);
      color: #6c757d;
      font-size: 0.85em;
      text-align: center;
    }
    
    @media (max-width: 768px) {
      .grid {
        grid-template-columns: 1fr;
      }
      
      .nav {
        flex-direction: column;
        gap: 10px;
      }
      
      .header {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .nav {
        margin-top: 15px;
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="logo">
      <img src="https://blog.konectacentros.com/hubfs/logo.png" alt="Konecta Logo">
      Sistema de Gestión de Pedidos
    </div>
    <div class="nav">
      <a href="#" class="nav-link active" data-tab="pedidos">Pedidos</a>
      <a href="#" class="nav-link" data-tab="armado">Armado</a>
      <a href="#" class="nav-link" data-tab="control">Control</a>
      <a href="#" class="nav-link" data-tab="ayuda">Ayuda</a>
    </div>
  </div>
  
  <div class="container">
    <div class="alert alert-warning">
      <strong>Modo Emergencia:</strong> Está utilizando la versión simplificada del Sistema de Gestión de Pedidos. 
      Algunas funcionalidades pueden estar limitadas. <a href="/">Intentar regresar a la versión completa</a>.
    </div>
    
    <!-- Contenido de la pestaña Pedidos -->
    <div id="pedidos" class="tab-content active">
      <h1>Lista de Pedidos</h1>
      
      <div class="search-box">
        <input type="text" id="search-pedidos" class="search-input" placeholder="Buscar por número o cliente...">
        <button class="search-button" onclick="buscarPedidos()">Buscar</button>
      </div>
      
      <div class="card">
        <h2 class="card-title">Pedidos Recientes</h2>
        <div id="lista-pedidos">
          <p>Cargando pedidos...</p>
        </div>
      </div>
    </div>
    
    <!-- Contenido de la pestaña Armado -->
    <div id="armado" class="tab-content">
      <h1>Armado de Pedidos</h1>
      
      <div class="alert alert-info">
        Seleccione un pedido de la lista para comenzar o continuar su armado.
      </div>
      
      <div class="card">
        <h2 class="card-title">Pedidos Pendientes de Armado</h2>
        <div id="pedidos-armado">
          <p>Cargando pedidos pendientes...</p>
        </div>
      </div>
    </div>
    
    <!-- Contenido de la pestaña Control -->
    <div id="control" class="tab-content">
      <h1>Control de Pedidos</h1>
      
      <div class="alert alert-info">
        Verifique los pedidos armados y confirme su estado.
      </div>
      
      <div class="card">
        <h2 class="card-title">Pedidos Pendientes de Verificación</h2>
        <div id="pedidos-control">
          <p>Cargando pedidos para control...</p>
        </div>
      </div>
    </div>
    
    <!-- Contenido de la pestaña Ayuda -->
    <div id="ayuda" class="tab-content">
      <h1>Ayuda del Sistema</h1>
      
      <div class="card">
        <h2 class="card-title">Información General</h2>
        <p>Este es el sistema de gestión de pedidos para el armado y control de órdenes de Konecta.</p>
        <p>Versión: <strong>1.0 (Emergencia)</strong></p>
        
        <h3>Instrucciones Básicas:</h3>
        <ol>
          <li><strong>Pedidos:</strong> Visualice todos los pedidos del sistema.</li>
          <li><strong>Armado:</strong> Inicie o continúe el armado de pedidos pendientes.</li>
          <li><strong>Control:</strong> Verifique los pedidos armados antes de finalizarlos.</li>
        </ol>
        
        <p>Si encuentra algún problema, refresque la página o contacte al administrador del sistema.</p>
        
        <div class="alert alert-info">
          <strong>Nota:</strong> Esta es una versión simplificada del sistema que se muestra durante el mantenimiento.
        </div>
      </div>
    </div>
    
    <div class="footer">
      © Konecta 2025. Sistema de Gestión de Pedidos - Versión de Emergencia
    </div>
  </div>
  
  <script>
    // Función para cambiar entre pestañas
    document.querySelectorAll('.nav-link').forEach(tab => {
      tab.addEventListener('click', function(e) {
        e.preventDefault();
        
        // Quitar la clase active de todos los enlaces y tabs
        document.querySelectorAll('.nav-link').forEach(item => {
          item.classList.remove('active');
        });
        document.querySelectorAll('.tab-content').forEach(content => {
          content.classList.remove('active');
        });
        
        // Añadir la clase active al enlace actual
        this.classList.add('active');
        
        // Mostrar el contenido correspondiente
        const tabId = this.getAttribute('data-tab');
        document.getElementById(tabId).classList.add('active');
      });
    });
    
    // Función para cargar pedidos
    async function cargarPedidos() {
      try {
        const response = await fetch('/api/pedidos');
        if (!response.ok) {
          throw new Error('Error al cargar los pedidos');
        }
        
        const pedidos = await response.json();
        
        const listaPedidos = document.getElementById('lista-pedidos');
        if (pedidos && pedidos.length > 0) {
          let html = '<table class="table">';
          html += '<thead><tr><th>ID</th><th>Cliente</th><th>Fecha</th><th>Estado</th><th>Acciones</th></tr></thead><tbody>';
          
          pedidos.forEach(pedido => {
            html += `
              <tr>
                <td>${pedido.id}</td>
                <td>${pedido.cliente}</td>
                <td>${new Date(pedido.fecha).toLocaleDateString()}</td>
                <td><span class="status-badge status-${pedido.estado.toLowerCase().replace(' ', '-')}">${pedido.estado}</span></td>
                <td>
                  <a href="#" class="btn btn-success btn-sm" onclick="verDetallePedido(${pedido.id})">Ver</a>
                </td>
              </tr>
            `;
          });
          
          html += '</tbody></table>';
          listaPedidos.innerHTML = html;
        } else {
          listaPedidos.innerHTML = '<p>No hay pedidos disponibles.</p>';
        }
        
      } catch (error) {
        console.error('Error:', error);
        document.getElementById('lista-pedidos').innerHTML = '<div class="alert alert-danger">Error al cargar los pedidos. <button onclick="cargarPedidos()">Reintentar</button></div>';
      }
    }
    
    // Función para buscar pedidos
    function buscarPedidos() {
      const searchTerm = document.getElementById('search-pedidos').value.toLowerCase();
      const rows = document.querySelectorAll('#lista-pedidos table tbody tr');
      
      rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        if (text.includes(searchTerm)) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      });
    }
    
    // Función para cargar pedidos pendientes de armado
    async function cargarPedidosArmado() {
      try {
        const response = await fetch('/api/pedidos/pendientes-armado');
        if (!response.ok) {
          throw new Error('Error al cargar pedidos pendientes');
        }
        
        const pedidos = await response.json();
        const contenedor = document.getElementById('pedidos-armado');
        
        if (pedidos && pedidos.length > 0) {
          let html = '<div class="grid">';
          
          pedidos.forEach(pedido => {
            html += `
              <div class="card">
                <h3>Pedido #${pedido.id}</h3>
                <p><strong>Cliente:</strong> ${pedido.cliente}</p>
                <p><strong>Fecha:</strong> ${new Date(pedido.fecha).toLocaleDateString()}</p>
                <p><strong>Productos:</strong> ${pedido.cantidadProductos || '?'}</p>
                <button class="btn" onclick="iniciarArmado(${pedido.id})">Iniciar Armado</button>
              </div>
            `;
          });
          
          html += '</div>';
          contenedor.innerHTML = html;
        } else {
          contenedor.innerHTML = '<p>No hay pedidos pendientes de armado.</p>';
        }
        
      } catch (error) {
        console.error('Error:', error);
        document.getElementById('pedidos-armado').innerHTML = '<div class="alert alert-danger">Error al cargar los pedidos. <button onclick="cargarPedidosArmado()">Reintentar</button></div>';
      }
    }
    
    // Función para cargar pedidos pendientes de control
    async function cargarPedidosControl() {
      try {
        const response = await fetch('/api/pedidos/pendientes-control');
        if (!response.ok) {
          throw new Error('Error al cargar pedidos para control');
        }
        
        const pedidos = await response.json();
        const contenedor = document.getElementById('pedidos-control');
        
        if (pedidos && pedidos.length > 0) {
          let html = '<div class="grid">';
          
          pedidos.forEach(pedido => {
            html += `
              <div class="card">
                <h3>Pedido #${pedido.id}</h3>
                <p><strong>Cliente:</strong> ${pedido.cliente}</p>
                <p><strong>Armado por:</strong> ${pedido.armadoPor || 'N/A'}</p>
                <p><strong>Fecha armado:</strong> ${pedido.fechaArmado ? new Date(pedido.fechaArmado).toLocaleString() : 'N/A'}</p>
                <button class="btn" onclick="iniciarControl(${pedido.id})">Iniciar Control</button>
              </div>
            `;
          });
          
          html += '</div>';
          contenedor.innerHTML = html;
        } else {
          contenedor.innerHTML = '<p>No hay pedidos pendientes de control.</p>';
        }
        
      } catch (error) {
        console.error('Error:', error);
        document.getElementById('pedidos-control').innerHTML = '<div class="alert alert-danger">Error al cargar los pedidos. <button onclick="cargarPedidosControl()">Reintentar</button></div>';
      }
    }
    
    // Función para ver detalle de un pedido
    function verDetallePedido(id) {
      alert(`Ver detalle del pedido ${id} - Funcionalidad no disponible en modo de emergencia`);
    }
    
    // Función para iniciar armado
    function iniciarArmado(id) {
      alert(`Iniciar armado del pedido ${id} - Funcionalidad no disponible en modo de emergencia`);
    }
    
    // Función para iniciar control
    function iniciarControl(id) {
      alert(`Iniciar control del pedido ${id} - Funcionalidad no disponible en modo de emergencia`);
    }
    
    // Inicializar datos al cargar la página
    window.addEventListener('DOMContentLoaded', () => {
      // Intentar cargar datos iniciales
      cargarPedidos();
      cargarPedidosArmado();
      cargarPedidosControl();
    });
  </script>
</body>
</html>