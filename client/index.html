<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
    <title>Sistema de Gestión de Pedidos</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- SISTEMA DE BLOQUEO DE ERRORES - MÉTODOS COMBINADOS -->
    <style>
      /* Ocultar completamente cualquier elemento relacionado con el plugin de errores */
      [data-plugin="runtime-error-plugin"],
      [id*="runtime-error"],
      [class*="runtime-error"],
      .vite-error-overlay,
      .error-overlay,
      [class*="overlay-root"],
      [class*="overlay-container"] {
        display: none !important;
        visibility: hidden !important;
        opacity: 0 !important;
        z-index: -9999 !important;
        position: absolute !important;
        top: -9999px !important;
        left: -9999px !important;
        width: 0 !important;
        height: 0 !important;
        overflow: hidden !important;
        pointer-events: none !important;
      }
    </style>
    
    <!-- Script de bloqueo principal - debe estar lo más arriba posible -->
    <script>
      (function() {
        try {
          // Sobrescribir Object.defineProperty para prevenir que el plugin se instale
          const originalDefineProperty = Object.defineProperty;
          Object.defineProperty = function(obj, prop, descriptor) {
            // Bloquear la definición de propiedades relacionadas con el plugin
            if (prop && typeof prop === 'string' && 
                (prop.includes('__RUNTIME_ERROR') || 
                 prop.includes('runtimeError'))) {
              console.log('Bloqueo de definición de propiedad:', prop);
              return obj;
            }
            return originalDefineProperty(obj, prop, descriptor);
          };
          
          // Objetos de reemplazo que no hacen nada
          const emptyErrorHandler = {
            init: function() {},
            hasError: function() { return false; },
            getError: function() { return null; },
            clearError: function() {}
          };
          
          const emptyErrorOverlay = {
            showError: function() {},
            clearError: function() {}
          };
          
          // Definir los objetos de error como vacíos
          window.__RUNTIME_ERROR_OVERLAY__ = emptyErrorOverlay;
          window.runtimeErrorHandler = emptyErrorHandler;
          window.__RUNTIME_ERROR_PLUGIN_ACTIVE__ = false;
          
          // Intentar hacer las propiedades no configurables
          try {
            Object.defineProperties(window, {
              '__RUNTIME_ERROR_OVERLAY__': {
                value: emptyErrorOverlay,
                writable: false,
                configurable: false
              },
              '__RUNTIME_ERROR_PLUGIN_ACTIVE__': {
                value: false,
                writable: false,
                configurable: false
              },
              'runtimeErrorHandler': {
                value: emptyErrorHandler,
                writable: false,
                configurable: false
              }
            });
          } catch (e) {
            console.warn('No se pudieron bloquear propiedades:', e);
          }
          
          // Sobrescribir addEventListener para bloquear eventos de error
          const originalAddEventListener = window.addEventListener;
          window.addEventListener = function(type, listener, options) {
            if (type === 'error' || type === 'unhandledrejection') {
              // Verificar si el listener está relacionado con el plugin
              if (listener && listener.toString().includes('runtime-error')) {
                console.log('Interceptado registro de evento:', type);
                return { type, listener, options };
              }
            }
            return originalAddEventListener.call(this, type, listener, options);
          };
          
          // Agregar nuestros propios interceptores de eventos de error
          originalAddEventListener.call(window, 'error', function(e) {
            if (e.filename && (
                e.filename.includes('runtime-error') || 
                e.message && e.message.includes('runtime-error')
            )) {
              console.warn('Error de plugin bloqueado:', e.message?.substring(0, 50));
              e.preventDefault();
              e.stopPropagation();
              return true;
            }
          }, true);
          
          originalAddEventListener.call(window, 'unhandledrejection', function(e) {
            if (e.reason && e.reason.stack && 
                typeof e.reason.stack === 'string' && 
                e.reason.stack.includes('runtime-error')) {
              console.warn('Rechazo de promesa bloqueado');
              e.preventDefault();
              e.stopPropagation();
              return true;
            }
          }, true);
          
          console.log('Sistema de bloqueo de errores iniciado correctamente');
        } catch (err) {
          console.warn('Error en sistema de bloqueo:', err);
        }
      })();
    </script>
    
    <!-- Cargar scripts adicionales de bloqueo -->
    <script src="/js/runtime-error-fix.js"></script>
    <script src="/js/error-interceptor.js"></script>
  </head>
  <body>
    <div id="root"></div>
    
    <!-- Fallback content that will be shown if the React app fails to load -->
    <div id="fallback-content" style="display: none; padding: 20px; max-width: 800px; margin: 40px auto; border: 1px solid #f0ad4e; background-color: #fcf8e3; border-radius: 5px;">
      <h1 style="color: #8a6d3b;">Sistema de Gestión de Pedidos - Konecta</h1>
      <p>El sistema está experimentando dificultades técnicas. Estamos intentando cargar la interfaz...</p>
      <p style="margin-bottom: 15px;">Opciones disponibles:</p>
      <ul style="margin-bottom: 20px;">
        <li><a href="/recovery" style="color: #0066cc; text-decoration: underline;">Ir a la página de recuperación</a></li>
        <li><a href="/static-app" style="color: #0066cc; font-weight: bold; text-decoration: underline;">Usar la versión estática del sistema</a> (recomendado)</li>
      </ul>
      <div style="margin-top: 20px;">
        <a href="/static-app" style="display: inline-block; padding: 10px 16px; background-color: #17a2b8; color: white; text-decoration: none; border-radius: 4px; font-weight: bold;">Acceder a la versión estática</a>
      </div>
    </div>
    
    <!-- Script que muestra el contenido de fallback si la app no carga en 5 segundos -->
    <script>
      // Mostrar el contenido de fallback después de 5 segundos si la app no carga
      setTimeout(function() {
        const rootElement = document.getElementById('root');
        // Si el elemento root no tiene hijos, significa que la app no ha cargado
        if (rootElement && (!rootElement.children || rootElement.children.length === 0)) {
          console.log('La aplicación no ha cargado, mostrando contenido de fallback');
          document.getElementById('fallback-content').style.display = 'block';
        }
      }, 5000);
    </script>
    
    <!-- Intento principal de carga de la aplicación -->
    <script type="module" src="/src/main.tsx"></script>
    
    <!-- Replit banner script -->
    <script type="text/javascript" src="https://replit.com/public/js/replit-dev-banner.js"></script>
  </body>
</html>
