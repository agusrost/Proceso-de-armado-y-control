<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
    <title>Sistema de Gestión de Pedidos</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- SISTEMA DE BLOQUEO DE ERRORES - MÉTODOS COMBINADOS -->
    <style>
      /* Ocultar completamente cualquier elemento relacionado con el plugin de errores */
      [data-plugin="runtime-error-plugin"],
      [id*="runtime-error"],
      [class*="runtime-error"],
      .vite-error-overlay,
      .error-overlay,
      [class*="overlay-root"],
      [class*="overlay-container"] {
        display: none !important;
        visibility: hidden !important;
        opacity: 0 !important;
        z-index: -9999 !important;
        position: absolute !important;
        top: -9999px !important;
        left: -9999px !important;
        width: 0 !important;
        height: 0 !important;
        overflow: hidden !important;
        pointer-events: none !important;
      }
    </style>
    
    <!-- Script de bloqueo principal - debe estar lo más arriba posible -->
    <script>
      (function() {
        try {
          // Sobrescribir Object.defineProperty para prevenir que el plugin se instale
          const originalDefineProperty = Object.defineProperty;
          Object.defineProperty = function(obj, prop, descriptor) {
            // Bloquear la definición de propiedades relacionadas con el plugin
            if (prop && typeof prop === 'string' && 
                (prop.includes('__RUNTIME_ERROR') || 
                 prop.includes('runtimeError'))) {
              console.log('Bloqueo de definición de propiedad:', prop);
              return obj;
            }
            return originalDefineProperty(obj, prop, descriptor);
          };
          
          // Objetos de reemplazo que no hacen nada
          const emptyErrorHandler = {
            init: function() {},
            hasError: function() { return false; },
            getError: function() { return null; },
            clearError: function() {}
          };
          
          const emptyErrorOverlay = {
            showError: function() {},
            clearError: function() {}
          };
          
          // Definir los objetos de error como vacíos
          window.__RUNTIME_ERROR_OVERLAY__ = emptyErrorOverlay;
          window.runtimeErrorHandler = emptyErrorHandler;
          window.__RUNTIME_ERROR_PLUGIN_ACTIVE__ = false;
          
          // Intentar hacer las propiedades no configurables
          try {
            Object.defineProperties(window, {
              '__RUNTIME_ERROR_OVERLAY__': {
                value: emptyErrorOverlay,
                writable: false,
                configurable: false
              },
              '__RUNTIME_ERROR_PLUGIN_ACTIVE__': {
                value: false,
                writable: false,
                configurable: false
              },
              'runtimeErrorHandler': {
                value: emptyErrorHandler,
                writable: false,
                configurable: false
              }
            });
          } catch (e) {
            console.warn('No se pudieron bloquear propiedades:', e);
          }
          
          // Sobrescribir addEventListener para bloquear eventos de error
          const originalAddEventListener = window.addEventListener;
          window.addEventListener = function(type, listener, options) {
            if (type === 'error' || type === 'unhandledrejection') {
              // Verificar si el listener está relacionado con el plugin
              if (listener && listener.toString().includes('runtime-error')) {
                console.log('Interceptado registro de evento:', type);
                return { type, listener, options };
              }
            }
            return originalAddEventListener.call(this, type, listener, options);
          };
          
          // Agregar nuestros propios interceptores de eventos de error
          originalAddEventListener.call(window, 'error', function(e) {
            if (e.filename && (
                e.filename.includes('runtime-error') || 
                e.message && e.message.includes('runtime-error')
            )) {
              console.warn('Error de plugin bloqueado:', e.message?.substring(0, 50));
              e.preventDefault();
              e.stopPropagation();
              return true;
            }
          }, true);
          
          originalAddEventListener.call(window, 'unhandledrejection', function(e) {
            if (e.reason && e.reason.stack && 
                typeof e.reason.stack === 'string' && 
                e.reason.stack.includes('runtime-error')) {
              console.warn('Rechazo de promesa bloqueado');
              e.preventDefault();
              e.stopPropagation();
              return true;
            }
          }, true);
          
          console.log('Sistema de bloqueo de errores iniciado correctamente');
        } catch (err) {
          console.warn('Error en sistema de bloqueo:', err);
        }
      })();
    </script>
    
    <!-- Cargar scripts adicionales de bloqueo - uso de version para evitar caché -->
    <script src="/js/runtime-error-fix.js?v=1"></script>
    <script src="/js/error-interceptor.js?v=1"></script>
    
    <!-- Script para prevenir el modo de recuperación -->
    <script>
      window.addEventListener('load', function() {
        // Detectar si estamos en la pantalla de fallback/recuperación
        setTimeout(function() {
          if (document.body.textContent.includes('Hmm... We couldn\'t reach this app') ||
              document.body.innerHTML.includes('app has a port open') ||
              document.body.innerHTML.includes('Learn more about hosting on Replit')) {
            
            console.error('¡Detectado modo de recuperación! Intentando reiniciar...');
            
            // Intentar recargar la página para evitar el fallback
            window.location.reload(true);
          } else {
            console.log('Aplicación cargada correctamente sin fallback');
          }
        }, 3000); // Verificar después de 3 segundos
      });
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    <!-- This is a replit script which adds a banner on the top of the page when opened in development mode outside the replit environment -->
    <script type="text/javascript" src="https://replit.com/public/js/replit-dev-banner.js"></script>
  </body>
</html>
